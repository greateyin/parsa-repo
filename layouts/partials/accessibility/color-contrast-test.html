{{/* Color Contrast Testing and WCAG Compliance Checker */}}
{{ if not hugo.IsProduction }}
<div id="accessibility-test-panel" class="fixed bottom-4 right-4 z-50 bg-card border border-border rounded-lg shadow-lg p-4 max-w-sm hidden" role="complementary" aria-label="Accessibility Testing Panel">
  <div class="flex items-center justify-between mb-3">
    <h3 class="font-semibold text-sm">Accessibility Test</h3>
    <button onclick="toggleAccessibilityPanel()" class="text-muted-foreground hover:text-foreground">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>
  
  <div class="space-y-3 text-xs">
    <div>
      <label class="block font-medium mb-1">Test Color Contrast:</label>
      <div class="grid grid-cols-2 gap-2">
        <div class="bg-primary text-primary-foreground p-2 rounded text-center">Primary</div>
        <div class="bg-muted text-muted-foreground p-2 rounded text-center">Muted</div>
      </div>
    </div>
    
    <div>
      <label class="block font-medium mb-1">Focus Indicators:</label>
      <button class="w-full p-2 border rounded focus-enhanced">Test Focus</button>
    </div>
    
    <div>
      <label class="block font-medium mb-1">Touch Targets:</label>
      <div class="grid grid-cols-3 gap-1">
        <button class="touch-target bg-muted rounded text-xs">44px</button>
        <button class="touch-target bg-muted rounded text-xs">Min</button>
        <button class="touch-target bg-muted rounded text-xs">Size</button>
      </div>
    </div>
    
    <div>
      <button onclick="runAccessibilityAudit()" class="w-full bg-primary text-primary-foreground p-2 rounded text-xs hover:bg-primary/90">
        Run A11y Audit
      </button>
    </div>
  </div>
</div>

<button onclick="toggleAccessibilityPanel()" 
        class="fixed bottom-4 right-4 z-40 bg-primary text-primary-foreground p-3 rounded-full shadow-lg hover:bg-primary/90 focus-enhanced"
        aria-label="Toggle accessibility testing panel"
        title="Accessibility Testing">
  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
  </svg>
</button>

<script>
function toggleAccessibilityPanel() {
  const panel = document.getElementById('accessibility-test-panel');
  panel.classList.toggle('hidden');
}

function runAccessibilityAudit() {
  const results = [];
  
  // Check color contrast
  const elements = document.querySelectorAll('*');
  elements.forEach(el => {
    const styles = window.getComputedStyle(el);
    const color = styles.color;
    const backgroundColor = styles.backgroundColor;
    
    if (color && backgroundColor && backgroundColor !== 'rgba(0, 0, 0, 0)') {
      // Simple contrast check (would need proper contrast calculation in production)
      const contrast = calculateContrast(color, backgroundColor);
      if (contrast < 4.5) {
        results.push(`Low contrast: ${el.tagName} - ${contrast.toFixed(2)}:1`);
      }
    }
  });
  
  // Check focus indicators
  const focusableElements = document.querySelectorAll('a, button, input, select, textarea, [tabindex]:not([tabindex="-1"])');
  focusableElements.forEach(el => {
    if (!el.classList.contains('focus-enhanced') && !el.style.outline) {
      results.push(`Missing focus indicator: ${el.tagName}`);
    }
  });
  
  // Check touch targets
  const interactiveElements = document.querySelectorAll('button, a, input, select');
  interactiveElements.forEach(el => {
    const rect = el.getBoundingClientRect();
    if (rect.width < 44 || rect.height < 44) {
      if (!el.classList.contains('touch-target')) {
        results.push(`Small touch target: ${el.tagName} (${rect.width}x${rect.height})`);
      }
    }
  });
  
  // Check ARIA labels
  const buttons = document.querySelectorAll('button:not([aria-label]):not([aria-labelledby])');
  buttons.forEach(button => {
    if (!button.textContent.trim()) {
      results.push(`Button missing accessible name: ${button.outerHTML.substring(0, 50)}...`);
    }
  });
  
  // Display results
  if (results.length === 0) {
    alert('✅ No accessibility issues found!');
  } else {
    alert(`⚠️ Found ${results.length} accessibility issues:\n\n${results.slice(0, 10).join('\n')}`);
  }
}

function calculateContrast(color1, color2) {
  // Simplified contrast calculation - would need proper implementation
  return Math.random() * 10 + 3; // Mock value for demo
}
</script>
{{ end }}